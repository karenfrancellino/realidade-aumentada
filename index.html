<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Bibliotecas -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
  </head>

  <body style="margin:0; overflow:hidden;">

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">

      <!-- Marcador Hiro -->
      <a-marker preset="hiro">
        <a-entity
          id="personagem"
          gltf-model="https://raw.githubusercontent.com/KarenFrancellino/ar-models/main/DROYZ_ANIMAPP_SiCkJacken_v005.glb"
          scale="1 1 1"
          position="0 0 0"
          animation-mixer>
        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <!-- BotÃµes -->
    <button id="screenshotButton" style="position:absolute; bottom:10px; left:10px; z-index:999; padding:10px;">
      ðŸ“¸ Sacar Foto
    </button>
    <button id="recordButton" style="position:absolute; bottom:10px; right:10px; z-index:999; padding:10px;">
      ðŸ”´ Grabar VÃ­deo
    </button>

    <script>
      // Toca a primeira animaÃ§Ã£o automaticamente
      const entity = document.querySelector('#personagem');
entity.addEventListener('model-loaded', (e) => {
  const model = e.detail.model;
  const animations = model.animations;
  console.log('AnimaÃ§Ãµes disponÃ­veis:', animations.map(a => a.name));

        i  // Toca a animaÃ§Ã£o especÃ­fica pelo nome
  if (animations && animations.length > 0) {
    entity.setAttribute('animation-mixer', {
      clip: "SickJacken_rigAction", // nome exato da animaÃ§Ã£o
      loop: 'repeat',
      timeScale: 1
    });
  }else {
          console.warn('Nenhuma animaÃ§Ã£o encontrada no modelo.');
        }
      });

      // Screenshot
      const scene = document.querySelector('a-scene');
      const screenshotButton = document.querySelector('#screenshotButton');
      screenshotButton.addEventListener('click', () => {
        scene.components.screenshot.capture('filename', 'ar-screenshot.png');
        alert('Screenshot capturado e salvo como ar-screenshot.png!');
      });

      // GravaÃ§Ã£o
      let recorder;
      const recordButton = document.querySelector('#recordButton');
let recorder, isRecording = false;

recordButton.addEventListener('click', () => {
  if (!isRecording) {
    // Inicia gravaÃ§Ã£o usando getDisplayMedia
    navigator.mediaDevices.getDisplayMedia({ video: true })
      .then(stream => {
        recorder = new MediaRecorder(stream);
        const chunks = [];

        recorder.ondataavailable = e => {
          if (e.data.size > 0) chunks.push(e.data);
        };

        recorder.onstop = () => {
          const blob = new Blob(chunks, { type: 'video/webm' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'ar-video.webm';
          a.click();
          URL.revokeObjectURL(url);
        };

        recorder.start();
        isRecording = true;
        recordButton.textContent = 'â¹ Parar GravaÃ§Ã£o';
        recordButton.style.backgroundColor = 'red';
      })
      .catch(err => {
        console.error('Erro ao capturar tela:', err);
        alert('Erro ao iniciar a gravaÃ§Ã£o.');
      });
  } else {
    // Para a gravaÃ§Ã£o
    recorder.stop();
    isRecording = false;
    recordButton.textContent = 'ðŸ”´ Iniciar GravaÃ§Ã£o';
    recordButton.style.backgroundColor = '';
  }
});
    </script>

  </body>
</html>
