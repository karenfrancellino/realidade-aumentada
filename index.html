<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Bibliotecas -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.3.2/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
  </head>

  <body style="margin:0; overflow:hidden;">

    <a-scene embedded 
      renderer="preserveDrawingBuffer: true"
      arjs="sourceType: webcam; 
      debugUIEnabled: false;">

      <!-- Marcador Hiro -->
      <a-marker preset="hiro">
        <a-entity
          id="personagem"
          gltf-model="https://raw.githubusercontent.com/KarenFrancellino/ar-models/main/DROYZ_ANIMAPP_SiCkJacken_v005.glb"
          scale="2 2 2"
          position="0 0.5 0"
          animation-mixer="clip: SickJacken_rigAction; loop: repeat">
        </a-entity>
        
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>

    <!-- Bot√µes -->
    <button id="screenshotButton" style="position:absolute; bottom:10px; left:10px; z-index:999; padding:10px;">
      üì∏ Hacer foto
    </button>
    <button id="recordButton" style="position:absolute; bottom:10px; right:10px; z-index:999; padding:10px;">
      üî¥ Grabar v√≠deo
    </button>

    <script>
      // Toca a primeira anima√ß√£o automaticamente
   const entity = document.querySelector('#personagem');

  entity.addEventListener('model-loaded', e => {
    console.log(
      'Anima√ß√µes dispon√≠veis:',
      e.detail.model.animations.map(a => a.name)
    );
  });

      // Screenshot
      const scene = document.querySelector('a-scene');
      const screenshotButton = document.querySelector('#screenshotButton');
      screenshotButton.addEventListener('click', () => {
 if (!scene.renderer) return;
        
  const canvas = scene.renderer.domElement;
        
const link = document.createElement('a');
link.href = canvas.toDataURL('image/png');
link.download = 'ar-screenshot.png';
link.click();
        screenshotButton.textContent = '‚úÖ Foto guardada';
setTimeout(() => {
  screenshotButton.textContent = 'üì∏ Hacer Foto';
}, 1500);
      });

      // Grava√ß√£o
      const recordButton = document.querySelector('#recordButton');
  let recorder;
  let isRecording = false;
recordButton.addEventListener('click', () => {
   if (!scene.renderer) return;

    const canvas = scene.renderer.domElement;

  if (!isRecording) {
    const stream = canvas.captureStream();
    const chunks = [];
     recorder = new MediaRecorder(stream);
    recorder.ondataavailable = e => { 
      if (e.data.size > 0) chunks.push(e.data);
      };
    
    recorder.onstop = () => {
      const blob = new Blob(chunks, { type: 'video/webm' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = 'ar-video.webm';
      a.click();
      URL.revokeObjectURL(url);
    };
    
    recorder.start();
    isRecording = true;
    recordButton.textContent = '‚èπ Detener grabaci√≥n';
    recordButton.style.backgroundColor = 'red';
  } else {
    recorder.stop();
    isRecording = false;
    recordButton.textContent = 'üî¥ Grabar v√≠deo';
    recordButton.style.backgroundColor = '';
  }
});

    </script>

  </body>
</html>
