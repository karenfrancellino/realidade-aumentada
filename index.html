 <!DOCTYPE html>
<html lang="es">
  
    <head> <!-- √Årea de configura√ß√µes e importa√ß√µes do projeto -->
    <!-- Define que o texto da p√°gina usa UTF-8 (acentos e emojis n√£o quebram) -->
    <meta charset="utf-8">
    <!-- Ajusta a visualiza√ß√£o em celulares para ocupar toda a tela -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <!-- Permite que a p√°gina funcione como "app" no iPhone -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- Permite que a p√°gina funcione como "app" no Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <!-- Importa A-Frame ‚Üí a biblioteca que cria objetos 3D -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <!-- Permite movimento do personagem -->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <!-- Importa AR.js ‚Üí a biblioteca que ativa a Realidade Aumentada -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
     <!-- Importa biblioteca para screenshot-->
    <script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
    <!-- Ferramenta para acionar tela ceheia nos dispositivos maiores-->
<style>
 canvas {
        width: 100% !important;
        height: 100% !important;
        position: absolute !important;
        top: 0; left: 0;
      }
  video {
    width: 100vw !important;
    height: 100vh !important;
    object-fit: cover !important; /* Faz o v√≠deo preencher sem distorcer */
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
  }
</style>
  </head>
  <!-- O que aparece na tela come√ßa no body + margin:0 ‚Üí tira margens da p√°gina + overflow:hidden ‚Üí remove barras de rolagem para a c√¢mera ocupar a tela -->
  <body style="margin:0; overflow:hidden;">
    <!-- Inicia a cena 3D + AR.js + Impede modo VR e deixa cena embutida na p√°gina + Diz que a fonte do v√≠deo √© a webcam/c√¢mera -->
  
    <a-scene 
  limpiar-profundidad                      
  embedded 
  arjs="sourceType: webcam; debugUIEnabled: false; videoTexture: true;" 
      
  renderer="
      preserveDrawingBuffer: true;
      antialias: true;
      alpha: false;
      logarithmicDepthBuffer: true;
      sortObjects: true;"
  vr-mode-ui="enabled: false">  <!-- videoTexture: true funde a cena do personagem com a da camera + preserveDrawingBuffer: true;Impede que o navegador limpe o buffer do desenho logo ap√≥s renderizar -->

      
      <!-- Acdiciona ilumina√ßao virtual-->
  <a-entity light="type: ambient; intensity: 1.5;"></a-entity>
  <a-entity light="type: directional; intensity: 0.8;" position="1 1 1"></a-entity>
     <!-- MARCADOR HIRO + Quando a c√¢mera detectar o marcador Hiro, tudo dentro aparece -->
  <a-marker preset="hiro">
    <!-- Adiciona id ao personagem + OBJETO 3D + Um personagem droys posicionada 0.5m acima do marcador -->
     <a-entity
      id="personagem"
      gltf-model="https://raw.githubusercontent.com/KarenFrancellino/ar-models/main/DROYZ_ANIMAPP_SiCkJacken_v005.glb"
      scale="3 3 3"
      position="0 0.5 0"
      crossorigin="anonymous"
      >
    </a-entity>
  </a-marker>
  
  <a-entity camera></a-entity>
</a-scene>
     <!-- Ancora para os botoes -->
      <div style="position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: space-around; z-index: 10000; pointer-events: none;">
     <!-- Botao screenshot -->
    <button id="btnScreenshot" style="pointer-events: auto; padding: 15px 20px; background: white; border-radius: 12px; border: 2px solid #333; font-weight: bold; box-shadow: 0px 4px 6px rgba(0,0,0,0.2);">
      üì∏ Sacar Foto
    </button>
    <!-- Botao grava√ßao de tela -->
    <button id="btnRecord" style="pointer-events: auto; padding: 15px 20px; background: white; border-radius: 12px; border: 2px solid #333; font-weight: bold; box-shadow: 0px 4px 6px rgba(0,0,0,0.2);">
      üî¥ Grabar V√≠deo
    </button>
</div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        
     AFRAME.registerComponent('limpiar-profundidad', {
  tick: function () {
    this.el.sceneEl.renderer.clearDepth();
  }
}); //Limpa cena
      
      //Sele√ß√£o de elementos do DOM e defini√ß√£o de estados globais
        const personagem = document.querySelector('#personagem');
        const btnFoto = document.querySelector('#btnScreenshot');
        const btnVideo = document.querySelector('#btnRecord');
        let gravador, gravando = false;

      // Gerenciamento de ciclo de vida do modelo 3D e ativa√ß√£o de anima√ß√µes
      personagem.addEventListener('model-loaded', (e) => {
        const model = e.detail.model;
        const animations = model.animations;
        console.log('Anima√ß√µes encontradas:', animations);
        
         if (animations && animations.length > 0)  {
          personagem.setAttribute('animation-mixer', {
    clip: "SickJacken_rigAction",
    loop: 'repeat',
    timeScale: 1
});

        }
      });

      // Implementa√ß√£o da captura de tela com fus√£o de buffers (Camada V√≠deo + Camada Canvas)
    btnFoto.addEventListener('click', () => {
  const canvas = document.querySelector('a-scene').canvas;
  if (!canvas) return;

  const link = document.createElement('a');
  link.download = 'foto-ar.png';
  link.href = canvas.toDataURL('image/png');
  link.click();
});
        
      // Controle de fluxo de grava√ß√£o de fluxo de m√≠dia (MediaStream) do Canvas
      btnVideo.addEventListener('click', () => {
    alert(
      '‚ö†Ô∏è Grava√ß√£o integrada n√£o √© suportada no Safari iOS.\n\n' +
      'Use a grava√ß√£o de tela nativa do iPhone.\n' +
      'No Android / Chrome funciona.'
    );
  });

});
</script>

</body>
</html>
