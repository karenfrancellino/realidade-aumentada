<!DOCTYPE html> <!-- Diz que o documento Ã© HTML5 -->

<html>
  <head> <!-- Ãrea de configuraÃ§Ãµes e importaÃ§Ãµes do projeto -->

    <!-- Define que o texto da pÃ¡gina usa UTF-8 (acentos e emojis nÃ£o quebram) -->
    <meta charset="utf-8">

    <!-- Ajusta a visualizaÃ§Ã£o em celulares para ocupar toda a tela -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <!-- Permite que a pÃ¡gina funcione como "app" no iPhone -->
    <meta name="apple-mobile-web-app-capable" content="yes">

    <!-- Permite que a pÃ¡gina funcione como "app" no Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Importa A-Frame â†’ a biblioteca que cria objetos 3D -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>

    <!-- Permite movimento do personagem -->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.2.0/dist/aframe-extras.min.js"></script>

    <!-- Importa AR.js â†’ a biblioteca que ativa a Realidade Aumentada -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

     <!-- Importa biblioteca para screenshot-->
    <script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>

  </head>

  <!-- O que aparece na tela comeÃ§a no body -->
   <!-- margin:0 â†’ tira margens da pÃ¡gina -->
    <!-- overflow:hidden â†’ remove barras de rolagem para a cÃ¢mera ocupar a tela -->
  <body style="margin:0; overflow:hidden;">
  
    <!-- Inicia a cena 3D + AR.js -->
     <!-- Impede modo VR e deixa cena embutida na pÃ¡gina -->
    <!-- Diz que a fonte do vÃ­deo Ã© a webcam/cÃ¢mera -->
    <a-scene 
      embedded                     
      arjs="sourceType: webcam;     
           debugUIEnabled: false;"> <!-- Remove botÃµes de debug da RA -->

      <!-- MARCADOR HIRO -->
      <!-- Quando a cÃ¢mera detectar o marcador Hiro, tudo dentro aparece -->
      <a-marker preset="hiro">

        <!-- Adiciona id ao personagem-->
        <!-- OBJETO 3D -->
        <!-- Um personagem droys posicionada 0.5m acima do marcador -->
  <a-entity 
    id="personagem"
    gltf-model="https://raw.githubusercontent.com/KarenFrancellino/ar-models/main/DROYZ_ANIMAPP_SiCkJacken_v005.glb"
    scale="3 3 3"
    position="0 0.5 0"
    animation-mixer>
  </a-entity>

      </a-marker>

      <!-- CÃ‚MERA -->
      <!-- A cÃ¢mera usada para visualizar a RA -->
      <a-entity camera></a-entity>
  </a-scene>
    
       <!-- Botao screenshot -->
         <button id="screenshotButton" style="position: absolute; bottom: 10px; left: 10px; z-index: 999; padding: 10px;">
      ðŸ“¸ Tirar Screenshot
    </button>

    <!-- Botao gravaÃ§ao de tela -->
    <button id="recordButton" style="position: absolute; bottom: 10px; right: 10px; z-index: 999; padding: 10px;">
      ðŸ”´ Iniciar GravaÃ§Ã£o
    </button>

    <script>
Â  Â  Â  // Seleciona a entidade do modelo 3D usando o ID que definimos ('personagem')
Â  Â  Â  const entity = document.querySelector('#personagem');
      
Â  Â  Â  // O nome da animaÃ§ao
Â  Â  Â  const SickJacken_rigAction = "SickJacken_rigAction";

Â  Â  Â  // Cria um 'listener' (ouvinte) que espera o evento 'model-loaded' (modelo carregado)
Â  Â  Â  entity.addEventListener('model-loaded', (e) => {
Â  Â  Â  Â  const model = e.detail.model;      // Pega o objeto 3D carregado
Â  Â  Â  Â  const animations = model.animations; // Pega a lista de animaÃ§Ãµes do objeto 3D

Â  Â  Â  Â  // Mostra no console a lista de animaÃ§Ãµes (Ãºtil para debug)
Â  Â  Â  Â  console.log('AnimaÃ§Ãµes disponÃ­veis:', animations.map(a => a.name));

Â  Â  Â  Â  // Ativa a animaÃ§ao se tiver
Â  Â  Â  Â  if (animations.length > 0) {
Â  Â  Â  Â  Â  // Configura o componente 'animation-mixer' para tocar a animaÃ§Ã£o desejada
Â  Â  Â  Â  Â  entity.setAttribute('animation-mixer', {
Â  Â  Â  Â  Â  Â  clip: SickJacken_rigAction,Â  // Usa o nome exato da animaÃ§Ã£o 
Â  Â  Â  Â  Â  Â  loop: 'repeat'Â  Â  Â  Â  Â  Â  Â // Faz a animaÃ§Ã£o repetir infinitamente
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  console.warn('Nenhuma animaÃ§Ã£o encontrada no modelo.'); // Mensagem de aviso se nenhuma animaÃ§Ã£o for encontrada
Â  Â  Â  Â  }
Â  Â  Â  });

      // --------------------------------------------------------
      // LÃ“GICA DE SCREENSHOT 
      // --------------------------------------------------------
      // Seleciona o elemento <a-scene> (a cena)
      const scene = document.querySelector('a-scene'); 
      // Seleciona o botÃ£o de screenshot
      const screenshotButton = document.querySelector('#screenshotButton'); 

      // Adiciona um 'listener' de clique ao botÃ£o de screenshot
      screenshotButton.addEventListener('click', () => { 
        // Usa o componente 'screenshot' embutido do A-Frame para capturar e salvar a imagem
        scene.components.screenshot.capture('perspective');
        // Alerta o usuÃ¡rio
        alert('Screenshot capturado');
      });

      // --------------------------------------------------------
      // LÃ“GICA DE GRAVAÃ‡ÃƒO DE VÃDEO
      // --------------------------------------------------------
      
      let recorder; // VariÃ¡vel para armazenar a instÃ¢ncia do RecordRTC
      const recordButton = document.querySelector('#recordButton'); // Seleciona o botÃ£o de gravaÃ§Ã£o
      let isRecording = false; // VariÃ¡vel de estado para saber se estÃ¡ gravando

      // Adiciona um 'listener' de clique ao botÃ£o de gravaÃ§Ã£o
      recordButton.addEventListener('click', () => { 
        if (!isRecording) {
         
          // --- LÃ“GICA PARA INICIAR GRAVAÃ‡ÃƒO --- 
          const canvas = document.querySelector('canvas'); // Pega o elemento <canvas>
          
          // Captura o stream de vÃ­deo do canvas (o que estÃ¡ sendo renderizado)
          const canvasStream = canvas.captureStream(30);
          
          // Cria uma nova instÃ¢ncia do RecordRTC
          recorder = new RecordRTC(canvasStream, {
            type: 'video',         // Tipo vÃ­deo
            mimeType: 'video/webm',// Formato webm
          });

          recorder.startRecording(); // Inicia a gravaÃ§Ã£o
          isRecording = true; // Atualiza o estado
          recordButton.textContent = 'â¹ Parar GravaÃ§Ã£o'; // Altera o texto
          recordButton.style.backgroundColor = 'red'; // Destaca o botÃ£o
          alert('GravaÃ§Ã£o iniciada!'); // Alerta o usuÃ¡rio
        } else {
          //  --- LÃ“GICA PARA PARAR GRAVAÃ‡ÃƒO --- 
          
          // Para a gravaÃ§Ã£o e executa a funÃ§Ã£o de callback
          recorder.stopRecording(() => { 
            const blob = recorder.getBlob(); // Pega o arquivo de vÃ­deo (Blob)
            
            // Cria link temporÃ¡rio para download
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); // Cria link <a>
            a.style.display = 'none'; // Oculta o link
            a.href = url; // Define o URL
            a.download = 'ar-video-recording.webm'; // Nome do arquivo
            document.body.appendChild(a); // Adiciona ao corpo
            a.click(); // Simula clique para download
            window.URL.revokeObjectURL(url); // Libera o URL
            
            isRecording = false; // Atualiza o estado
            recordButton.textContent = 'ðŸ”´ Iniciar GravaÃ§Ã£o'; // Restaura o texto
            recordButton.style.backgroundColor = ''; // Remove o destaque
            alert('GravaÃ§Ã£o parada e salva como ar-video-recording.webm!'); // Alerta
          });
        }
      });
Â  Â  </script>
  </body>
</html>
