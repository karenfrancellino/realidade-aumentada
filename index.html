<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Bibliotecas -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
  </head>

  <body style="margin:0; overflow:hidden;">

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">

      <!-- Marcador Hiro -->
      <a-marker preset="hiro">
        <a-entity
          id="personagem"
          gltf-model="https://raw.githubusercontent.com/KarenFrancellino/ar-models/main/DROYZ_ANIMAPP_SiCkJacken_v005.glb"
          scale="1 1 1"
          position="0 0 0"
          animation-mixer>
        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <!-- BotÃµes -->
    <button id="screenshotButton" style="position:absolute; bottom:10px; left:10px; z-index:999; padding:10px;">
      ðŸ“¸ Sacar Foto
    </button>
    <button id="recordButton" style="position:absolute; bottom:10px; right:10px; z-index:999; padding:10px;">
      ðŸ”´ Grabar VÃ­deo
    </button>

    <script>
      // Toca a primeira animaÃ§Ã£o automaticamente
      const entity = document.querySelector('#personagem');
      entity.addEventListener('model-loaded', (e) => {
        const model = e.detail.model;
        const animations = model.animations;
        console.log('AnimaÃ§Ãµes disponÃ­veis:', animations.map(a => a.name));

        if (animations.length > 0) {
          entity.setAttribute('animation-mixer', {
            clip: animations[0].name,
            loop: 'repeat'
          });
        } else {
          console.warn('Nenhuma animaÃ§Ã£o encontrada no modelo.');
        }
      });

      // Screenshot
      const scene = document.querySelector('a-scene');
      const screenshotButton = document.querySelector('#screenshotButton');
      screenshotButton.addEventListener('click', () => {
        scene.components.screenshot.capture('filename', 'ar-screenshot.png');
        alert('Screenshot capturado e salvo como ar-screenshot.png!');
      });

      // GravaÃ§Ã£o
      let recorder;
      const recordButton = document.querySelector('#recordButton');
      let isRecording = false;

      recordButton.addEventListener('click', () => {
        const canvas = document.querySelector('canvas');
        if (!isRecording) {
          const canvasStream = canvas.captureStream();
          recorder = new RecordRTC(canvasStream, { type:'video', mimeType:'video/webm' });
          recorder.startRecording();
          isRecording = true;
          recordButton.textContent = 'â¹ Parar GravaÃ§Ã£o';
          recordButton.style.backgroundColor = 'red';
          alert('GravaÃ§Ã£o iniciada!');
        } else {
          recorder.stopRecording(() => {
            const blob = recorder.getBlob();
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'ar-video-recording.webm';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            isRecording = false;
            recordButton.textContent = 'ðŸ”´ Iniciar GravaÃ§Ã£o';
            recordButton.style.backgroundColor = '';
            alert('GravaÃ§Ã£o parada e salva como ar-video-recording.webm!');
          });
        }
      });
    </script>

  </body>
</html>
